#!/usr/bin/env python

import sys
from twisted.eco import eco, sexpy


def interpret():
    """Run a command-line intepreter for ECO."""
    continuation = 0
    parser = sexpy.SymbolicExpressionReceiver()
    parser.connectionMade()
    l = []
    parser.symbolicExpressionReceived = l.append
    env = (eco.ValueEnvironment(), eco.FunctionEnvironment())
    
    while 1:
        if continuation:
            sys.stdout.write("... ")
        else:
            sys.stdout.write(">>> ")
        line = sys.stdin.readline()
        if not line:
            sys.stdout.write("\n")
            return
        parser.dataReceived(line)
        if l:
            value = l.pop()
            sys.stdout.write("%s\n" % eco.evalExp(eco.consify(value), env))
            continuation = 0
        else:
            continuation = 1


if __name__ == '__main__':
    interpret()
