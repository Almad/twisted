#!/usr/bin/make -f
#-*- makefile -*-
# Made with the aid of dh_make, by Craig Small
# Sample debian/rules that uses debhelper. GNU copyright 1997 by Joey Hess.
# Some lines taken from debmake, by Christoph Lameter.

build: build-stamp
build-stamp:
	rm -rf debian/python2.1-twisted debian/python2.2-twisted
	install -d debian/python2.1-twisted debian/python2.2-twisted
	/usr/bin/python2.1 setup.py install --no-compile --root debian/python2.1-twisted
	/usr/bin/python2.2 setup.py install --no-compile --root debian/python2.2-twisted
	touch build-stamp

clean:
	rm -f build-stamp install-stamp
	rm -rf build
	find . -name "*.pyc" |xargs -r rm
	# Add here commands to clean up after the build process.
	rm -rf debian/python*-twisted debian/twisted-doc


install: install-stamp
install-stamp: build-stamp 
	chmod +x debian/scripts/*
	debian/scripts/install 2.1
	debian/scripts/install 2.2
	debian/scripts/defaultpy

	install -d debian/twisted-doc/usr/share/doc/twisted-doc/
	install -d debian/twisted-doc/usr/share/doc/twisted-doc/examples
	install -d debian/twisted-doc/usr/share/doc/twisted-doc/howto
	install -d debian/twisted-doc/usr/share/doc/twisted-doc/img
	install -d debian/twisted-doc/usr/share/doc/twisted-doc/api
	install -m 644 debian/copyright \
	               debian/twisted-doc/usr/share/doc/twisted-doc/
	install -m 644 debian/changelog \
	               debian/twisted-doc/usr/share/doc/twisted-doc/changelog.Debian
	gzip -9 debian/twisted-doc/usr/share/doc/twisted-doc/changelog.Debian
	install -m 644 doc/howto/*.html \
	               debian/twisted-doc/usr/share/doc/twisted-doc/howto/
	install -m 644 doc/img/*.{png,bmp} \
	               debian/twisted-doc/usr/share/doc/twisted-doc/img/
	cp -ar doc/api/* debian/twisted-doc/usr/share/doc/twisted-doc/
	install -m 644  doc/examples/*.py \
	                debian/twisted-doc/usr/share/doc/twisted-doc/examples/
	install -d debian/twisted-doc/DEBIAN/
	install -m 755 debian/twisted-doc.prerm debian/twisted-doc/DEBIAN/prerm
	install -m 755 debian/twisted-doc.postinst debian/twisted-doc/DEBIAN/postinst

	install -d debian/python-twisted/usr/share/doc/python-twisted
	install -d debian/python-twisted/DEBIAN
	install -m 644 debian/copyright \
	               debian/python-twisted/usr/share/doc/python-twisted/
	install -m 644 debian/changelog \
	               debian/python-twisted/usr/share/doc/python-twisted/changelog.Debian
	gzip -9 debian/python-twisted/usr/share/doc/python-twisted/changelog.Debian
	install -m 644 debian/python-twisted.README.Debian \
	               debian/python-twisted/usr/share/doc/python-twisted/README.Debian
	install -m 755 debian/python-twisted.prerm debian/python-twisted/DEBIAN/prerm
	install -m 755 debian/python-twisted.postinst debian/python-twisted/DEBIAN/postinst
	touch install-stamp

binary-indep: build install
	dpkg-gencontrol -isp -ptwisted-doc -Pdebian/twisted-doc
	chown -R root.root debian/twisted-doc
	chmod -R go=rX debian/twisted-doc
	dpkg --build debian/twisted-doc ..

	dpkg-gencontrol -isp -ppython-twisted -Pdebian/python-twisted
	chown -R root.root debian/python-twisted
	chmod -R go=rX debian/python-twisted
	dpkg --build debian/python-twisted ..


binary-arch: build install
	find debian -name "*.so" | xargs -n 1 dpkg-shlibdeps

	dpkg-gencontrol -isp -ppython2.1-twisted -Pdebian/python2.1-twisted
	chown -R root.root debian/python2.1-twisted
	chmod -R go=rX debian/python2.1-twisted
	dpkg --build debian/python2.1-twisted ..

	dpkg-gencontrol -isp -ppython2.2-twisted -Pdebian/python2.2-twisted
	chown -R root.root debian/python2.2-twisted
	chmod -R go=rX debian/python2.2-twisted
	dpkg --build debian/python2.2-twisted ..

source diff:                                                                  
	@echo >&2 'source and diff are obsolete - use dpkg-source -b'; false

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
