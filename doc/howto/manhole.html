<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Manhole, The Twisted Interaction Client</title>
  </head>

  <body>
    <h1>Manhole, The Twisted Interaction Client</h1>

    <p>Manhole is a client that you can use to connect to the
    twisted.manhole service. It lets you execute arbitrary code on
    the server, thus it is a great administration and debugging
    tool.</p>

    <h2>Starting the twisted.manhole service</h2>

    <p>Execute the command <code class="shell">mktap manhole -u
    [username] -w [password]</code>. This will create a twisted
    application (.tap) file that has a <code
    class="API">twisted.manhole</code> service which will listen on
    port 8787. Execute the command 'twistd -f manhole.tap' to
    actually start the server.</p>

    <h2>Using manhole</h2>

    <p>You can execute the command <code
    class="shell">manhole</code> to start the GTK+ manhole client.
    This will give you a window asking for your username, password,
    hostname, service, perspective, and port number. Type in the
    username and password you selected above, the hostname that the
    twisted.manhole service was started on (localhost is the
    default), leave the Service the same ('twisted.manhole'), leave
    Perspective blank, and leave Port # as the default of 8787.
    Click the "Log In" button and you will be greeted with a short
    message in a window with an output area and an input area. You
    can type arbitrary python code into the input area and get the
    results in the output area.</p>

    <p>At this point, you can get access to the main <code class="API"
    base="twisted.internet.app">Application</code> object. You can use that
    to obtain the <code class="API" base="twisted.spread.pb">Service</code>
    objects inside it, or references to the <code class="API"
    base="twisted.internet.protocol">Factory</code> objects that are
    listening on TCP or UDP ports, by doing:</p>

<pre class="python-interpreter">
from twisted.internet import app
a = app.theApplication
service = a.getServiceNamed("manhole")
(port, factory, backlog, interface) = a.tcpPorts[0]
</pre>

    <p>After that, you can do anything you want with those objects. A more
    detailed example is at the bottom of this document.</p>


    <h2>Special Commands</h2>

    <p>There are a few special commands so far that make debugging
    Twisted objects really nice. These are <code>/browse</code> and
    <code>/watch</code>. You can <code>/browse</code> any type of
    object, and it will give you some nice information about that
    object. <code>/watch</code>-ing an object adds hooks to the
    object, allowing you to watch modifications to it in real time.
    For example:</p>
<pre class="python-interpreter">
/browse ["hello", "there"]
 <font
color="blue">&lt;ObjectLink of ["hello", "there"] type list&gt;:
  ['hello',
   'there',]
</font>

class A:
    def foo(self):
        self.x = 1
x = A()
/browse x
<font color="blue">&lt;ObjectLink of x type instance&gt;:
  {members: {}
   class: 'A'
   methods: {}}
</font>

/watch x
 <font color="blue"> &lt;ObjectLink of x type instance&gt;:
  {members: {}
   class: 'A'
   methods: {}}
</font>

x.foo()

<font color="blue">&lt;ObjectLink of x type instance&gt;:
  {members: {x: 1}
   class: 'twisted.python.explorer.WatchingA8195574'
   methods:
     {foo:
        &lt;ObjectLink of x.foo type instance_method&gt;:
          {class: 'twisted.python.explorer.WatchingA8195574'
           self: '&lt;twisted.python.explorer.WatchingA8195574 instance at 0x8195574&gt;'
           doc:
             Pretend to be the method I replaced, and ring the bell.
                     
           line: 651
           signature:
             [{name: instance},
              {name: a
               list: 1},
              {name: kw
               keywords: 1},]
           file: /home/punck/cvs/Twisted/twisted/python/explorer.py
           name: __call__}
        }}

&lt;ObjectLink of x type instance&gt;:
  {members: {x: 1}
   class: 'twisted.python.explorer.WatchingA8195574'
   methods:
     {foo:
        &lt;ObjectLink of x.foo type instance_method&gt;:
          {class: 'twisted.python.explorer.WatchingA8195574'
           self: '&lt;twisted.python.explorer.WatchingA8195574 instance at 0x8195574&gt;'
           doc:
             Pretend to be the method I replaced, and ring the bell.
                     
           line: 651
           signature:
             [{name: instance},
              {name: a
               list: 1},
              {name: kw
               keywords: 1},]
           file: /home/punck/cvs/Twisted/twisted/python/explorer.py
           name: __call__}
        }}
</font>
   
</pre>

    <p>As you can see, <code>/watch</code> really gives you a lot
    of power (and a lot of output, too -- hopefully we'll have a
    nice GUI display for this in the future). The
    <code>/browse</code> and <code>/watch</code> functionality is
    brought to you by the <code
    class="API">twisted.manhole.explorer</code> module, which was
    written largely by Kevin Turner.</p>

    <h2>Example</h2>

    <p>Here's an example of using the manhole service to examine and modify
    a running server. The sample code starts a Quote Of The Day (<code
    class="API" base="twisted.protocols.wire">QOTD</code>) server on port
    8123, as well as a manhole service on the usual port 8787.</p>

    <pre class="shell"># FIXME: there is no qotd plug-in for mktap.
% mktap qotd -p 8123
% mktap -a qotd.tap manhole -u username
Password:
Confirm:
% twistd -f qotd.tap
</pre>

    <p>Start this running, and test it out with <code class="shell">nc
    localhost 8123</code> (or <code class="shell">telnet localhost
    8123</code> if you don't have netcat installed).</p>

<pre class="shell">
% nc localhost 8123
An apple a day keeps the doctor away.
</pre>

    <p>Then start the <tt>manhole</tt> client and point it at the
    application: username is <tt>username</tt>, password is whatever
    you typed in at the prompt.
    The following is a transcript of the manhole session, and looks just
    like the normal python interpreter, with lines you type prefixed with
    <tt>&gt;&gt;&gt;</tt>.</p>

<pre class="python-interpreter">
Hello username, welcome to twisted.manhole in manhole-demo on some computer somewhere.
Twisted 0.99.2rc2.

&gt;&gt;&gt; from twisted.internet import app
&gt;&gt;&gt; a = app.theApplication
&gt;&gt;&gt; a
&lt;'manhole-demo' app&gt;
&gt;&gt;&gt; a.getServiceNamed("twisted.manhole")
&lt;twisted.manhole.service.Service instance at 0x82d63dc&gt;
&gt;&gt;&gt; a.tcpPorts
[(8123, &lt;twisted.internet.protocol.Factory instance at 0x82da454&gt;, 5, ''), (8787, &lt;twisted.spread.pb.BrokerFactory instance at 0x82dac7c&gt;, 5, '')]
&gt;&gt;&gt; f = a.tcpPorts[0][1]
&gt;&gt;&gt; f
&lt;twisted.internet.protocol.Factory instance at 0x82da454&gt;
&gt;&gt;&gt; dir(f)
['__doc__', '__implements__', '__module__', 'buildProtocol', 'doStart', 'doStop', 'noisy', 'numPorts', 'protocol', 'startFactory', 'stopFactory']
&gt;&gt;&gt; from twisted.protocols.wire import Daytime
&gt;&gt;&gt; a.tcpPorts[0][1].protocol = Daytime
</pre>

    <p>Congratulations, you've just changed the Factory to use the <code
    class="API" base="twisted.protocols.wire">Daytime</code> protocol
    instead of the <code class="API"
    base="twisted.protocols.wire">QOTD</code> protocol. Connect to port 8123
    now and see the difference: you get a timestamp instead of a quote:</p>

<pre class="shell">
% nc localhost 8123
Wed Sep 25 11:14:58 2002
</pre>

    <p>From here, you can do anything you want to your application. It is a
    good idea to check the source for the <code class="API"
    base="twisted.internet.app">Application</code> and <code class="API"
    base="twisted.cred.service">Service</code> classes to see what else you
    can extract from them.</p>

    <p>TODO: Add an example using <code class="API">twisted.python.rebuild.rebuild</code>.</p>

    <p>Have fun!</p>

    <hr />

    <address>
      <a href="mailto:carmstro@twistedmatrix.com">Chris
      Armstrong</a>
    </address>
    <!-- hhmts start -->Last modified: Wed Sep 25 14:39:50 PDT 2002 <!-- hhmts end -->
  </body>
</html>

