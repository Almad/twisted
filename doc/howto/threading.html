<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
  <title>Using Threads in Twisted</title>
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />
</head>

<body text="#000000" bgcolor="#ffffff">

<h1>Using Threads in Twisted</h1>

<h2>Introduction</h2>

<p>
Before you start using threads, make sure you do at the start of your program:
</p>

<pre class="python">
from twisted.python import threadable
threadable.init(1)
</pre>

<p>
This will make certain parts of Twisted thread-safe so you can use them safely.
However, note that most parts of Twisted are <i>not</i> thread-safe.
</p>

<h2>Running code in a thread-safe manner</h2>

<p>
Most code in Twisted is not thread-safe. For example, writing data to a
transport from a protocol is not thread-safe. Therefore, we want a way
to schedule methods to be run in the main event loop. This can be done using
the function <code class="API">twisted.internet.interfaces.IReactorCore.callFromThread</code>:
</p>

<pre class="python">
from twisted.internet import reactor
from twisted.python import threadable
threadable.init(1)

def notThreadSafe(x):
     """do something that isn't thread-safe"""
     # ...

def threadSafeScheduler():
    """Run in thread-safe manner."""
    reactor.callFromThread(notThreadSafe, 3) # will run 'notThreadSafe(3)' in the event loop
</pre>

</body>
</html>
