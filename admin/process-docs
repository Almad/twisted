#!/bin/sh
set -e -x
for file in doc/man/*.1;
do filename=`echo $file | sed 's/\.1$//'`
   python twisted/lore/man2lore.py $filename.1 > $filename-man.html
done
baseurl=http://twistedmatrix.com/documents/TwistedDocs/TwistedDocs-$1/api/%s.html
templ=doc/howto/template.tpl
for doc in doc/man doc/howto doc/specifications; do
  ./bin/hlint -p $doc/*.html
  ./bin/generatelore -p --docsdir $doc -t $templ --baseurl $baseurl \
                    -l ../howto/ $doc/*.html
  ./bin/html2latex -p -s --docsdir $doc $doc/*.html
done
cp admin/book.tex doc/howto
cd doc/howto
for i in 1 2 3;do latex book.tex;done
dvips -o book.ps book.dvi
ps2pdf13 book.ps book.pdf
rm *.eps *.tex *.aux *.log book.dvi book.toc ../man/*.tex \
   ../specifications/*.tex ../man/*-man.html
