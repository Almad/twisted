#!/bin/sh
set -e
url=http://twistedmatrix.com/documents/TwistedDocs/TwistedDocs-$1/api/%s.html
templ=doc/howto/template.tpl
echo "Man-->Lore"
./bin/lore -p --input man --output lore --config ext=-man.html doc/man/*.1
for doc in doc doc/man doc/howto doc/specifications doc/vision; do
	echo "Lore-->Lint"
	./bin/lore -n --output lint $doc/*.html |sed 's/^/WARNING: /'
	echo "Lore-->HTML"
	./bin/lore -p --config template=$templ --config baseurl=$url \
	           -l ../howto/ $doc/*.html
	echo "Lore-->LaTeX"
	./bin/lore -p --output latex --config section $doc/*.html
done
cp admin/book.tex doc/howto
cd doc/howto
for i in 1 2;do latex book.tex < /dev/null;done
latex book.tex </dev/null | sed '/^LaTeX Warning:/s/^/WARNING: /'
dvips -o book.ps book.dvi
ps2pdf13 book.ps book.pdf
rm *.eps *.tex *.aux *.log book.dvi book.toc ../man/*.tex \
   ../specifications/*.tex ../man/*-man.html ../vision/*.tex ../*.tex
