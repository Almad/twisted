#!/bin/sh
set -e
for file in doc/man/*.1;
do filename=`echo $file | sed 's/\.1$//'`
   groff -Thtml -man $filename.1 | \
   egrep -v '(^<a name=.*></a>$)|(^<a href.*<br>$)|(<hr>)|(^<tr )|(^<td )|(^ *cols=)|(^<meta )' | \
   sed -e 's#^<table.*#<p>#' -e 's#</td>.*#</p>#' -e 's/<b>/<strong>/g' \
       -e 's#</b>#</strong>#g' -e 's/<i>/<em>/g' -e 's#</i>#</em>#g' \
       -e 's/align=center//' -e 's#<br>#</p><p>#' > $filename.html
done
baseurl=http://twistedmatrix.com/documents/TwistedDocs/TwistedDocs-$1/api/%s.html
templ=doc/howto/template.tpl
for doc in doc/man doc/howto doc/specifications; do
  ./bin/generatelore --docsdir $doc -t $templ --baseurl $baseurl -l ../howto/
done
cp admin/book.tex doc/howto
./bin/html2latex -s doc/howto/*.html doc/man/*.html doc/specifications/*.html
cd doc/howto
latex book.tex
latex book.tex
latex book.tex
dvips -o book.ps book.dvi
ps2pdf13 book.ps book.pdf
rm *.eps *.tex *.aux *.log book.dvi book.toc ../man/*.tex \
   ../specifications/*.tex
